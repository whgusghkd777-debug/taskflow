<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow - ãƒãƒ¼ãƒ å”æ¥­ã‚’ã€ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #007AFF;
            --secondary: #5856D6;
            --success: #34C759;
            --danger: #FF3B30;
            --warning: #FF9500;
            --bg-primary: #F5F5F7;
            --bg-secondary: #FFFFFF;
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --border: #E5E5E7;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .navbar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
            letter-spacing: -0.5px;
        }

        .nav-links {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .btn {
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0051D5;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        /* ãƒ’ãƒ¼ãƒ­ãƒ¼ */
        .hero {
            text-align: center;
            padding: 120px 24px 80px;
            max-width: 980px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 72px;
            font-weight: 600;
            letter-spacing: -2px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #007AFF, #5856D6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 24px;
            color: var(--text-secondary);
            margin-bottom: 40px;
        }

        .hero-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
        }

        .btn-large {
            padding: 14px 32px;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* æ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ */
        .features {
            max-width: 1200px;
            margin: 80px auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 32px;
        }

        .feature-card {
            background: white;
            border-radius: 24px;
            padding: 48px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            text-align: center;
        }

        .feature-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-8px);
        }

        .feature-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto 24px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 48px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-modal:hover {
            background: var(--bg-primary);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .modal-header h2 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        .btn-block {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-block:hover {
            background: #0051D5;
        }

        .btn-block:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 24px;
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .dashboard-header h1 {
            font-size: 36px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            background: white;
            padding: 12px 20px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            padding: 32px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .stat-card.gradient {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .stat-number {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 16px;
            opacity: 0.8;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ */
        .content-section {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-icon:hover {
            transform: scale(1.1);
        }

        .task-item {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .task-item:hover {
            box-shadow: var(--shadow);
            transform: translateX(4px);
        }

        .task-info h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .task-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.todo {
            background: #E5E5E7;
            color: var(--text-primary);
        }

        .badge.progress {
            background: #FFE5CC;
            color: var(--warning);
        }

        .badge.done {
            background: #D1F2DD;
            color: var(--success);
        }

        .badge.high {
            background: #FFE5E5;
            color: var(--danger);
        }

        .badge.medium {
            background: #FFE5CC;
            color: var(--warning);
        }

        .badge.low {
            background: #E5F5FF;
            color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            display: none;
        }

        .alert.active {
            display: block;
        }

        .alert.success {
            background: #D1F2DD;
            color: var(--success);
        }

        .alert.error {
            background: #FFE5E5;
            color: var(--danger);
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .team-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .team-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-4px);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .team-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 16px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 48px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .nav-links:not(#dashboardNav) {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="#" class="logo" onclick="goHome()">TaskFlow</a>
            <div class="nav-links" id="mainNav">
                <a class="nav-link" onclick="scrollTo('features')">æ©Ÿèƒ½</a>
                <a class="nav-link" onclick="openModal('login')">ãƒ­ã‚°ã‚¤ãƒ³</a>
                <button class="btn btn-primary" onclick="openModal('signup')">ä»Šã™ãå§‹ã‚ã‚‹</button>
            </div>
            <div class="nav-links" id="dashboardNav" style="display: none;">
                <span class="nav-link" id="navEmail"></span>
                <button class="btn btn-primary" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </div>
    </nav>

    <!-- ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ -->
    <div id="landingPage">
        <section class="hero">
            <h1>ãƒãƒ¼ãƒ å”æ¥­ã‚’ã€<br>ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚</h1>
            <p>TaskFlowã§ã€ãƒãƒ¼ãƒ ã®ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚’ã‚‚ã£ã¨ç°¡å˜ã«ã€ã‚‚ã£ã¨åŠ¹ç‡çš„ã«ã€‚</p>
            <div class="hero-buttons">
                <button class="btn-large btn-primary" onclick="openModal('signup')">ç„¡æ–™ã§å§‹ã‚ã‚‹</button>
                <button class="btn-large btn-secondary" onclick="scrollTo('features')">è©³ã—ãè¦‹ã‚‹</button>
            </div>
        </section>

        <section class="features" id="features">
            <div class="feature-card">
                <div class="feature-icon">âœ…</div>
                <h3>ã‚¿ã‚¹ã‚¯ç®¡ç†</h3>
                <p>ç›´æ„Ÿçš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã€ã‚¿ã‚¹ã‚¯ã®ä½œæˆã‹ã‚‰å®Œäº†ã¾ã§ç°¡å˜ã«ç®¡ç†ã§ãã¾ã™ã€‚</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ‘¥</div>
                <h3>ãƒãƒ¼ãƒ å”æ¥­</h3>
                <p>ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ç°¡å˜ã«æƒ…å ±ã‚’å…±æœ‰ã—ã€ä¸€ç·’ã«ç›®æ¨™ã‚’é”æˆã—ã¾ã—ã‚‡ã†ã€‚</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ğŸ“Š</div>
                <h3>é€²æ—è¿½è·¡</h3>
                <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²è¡ŒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡ã§ãã¾ã™ã€‚</p>
            </div>
        </section>
    </div>

    <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div class="dashboard" id="dashboardPage">
        <div class="alert" id="alert"></div>

        <div class="dashboard-header">
            <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div>
                    <div style="font-weight: 600;" id="userName">ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
                    <div style="font-size: 14px; color: var(--text-secondary);" id="userEmail">user@example.com</div>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('tasks')">ã‚¿ã‚¹ã‚¯</button>
            <button class="tab" onclick="switchTab('teams')">ãƒãƒ¼ãƒ </button>
        </div>

        <!-- ã‚¿ã‚¹ã‚¯ã‚¿ãƒ– -->
        <div class="tab-content active" id="tasksTab">
            <div class="stats">
                <div class="stat-card gradient">
                    <div class="stat-number" id="totalTasks">0</div>
                    <div class="stat-label">å…¨ä½“ã‚¿ã‚¹ã‚¯</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todoTasks">0</div>
                    <div class="stat-label">æœªç€æ‰‹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="progressTasks">0</div>
                    <div class="stat-label">é€²è¡Œä¸­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="doneTasks">0</div>
                    <div class="stat-label">å®Œäº†</div>
                </div>
            </div>

            <div class="content-section">
                <div class="section-header">
                    <h3 class="section-title">ãƒã‚¤ã‚¿ã‚¹ã‚¯</h3>
                    <button class="btn-icon" onclick="openModal('createTask')" title="ã‚¿ã‚¹ã‚¯ä½œæˆ">+</button>
                </div>
                <div id="taskList"></div>
            </div>
        </div>

        <!-- ãƒãƒ¼ãƒ ã‚¿ãƒ– -->
        <div class="tab-content" id="teamsTab">
            <div class="content-section">
                <div class="section-header">
                    <h3 class="section-title">ãƒã‚¤ãƒãƒ¼ãƒ </h3>
                    <button class="btn-icon" onclick="openModal('createTeam')" title="ãƒãƒ¼ãƒ ä½œæˆ">+</button>
                </div>
                <div id="teamList"></div>
            </div>
        </div>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('login')">Ã—</button>
            <div class="modal-header">
                <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
                <p>TaskFlowã«ã‚ˆã†ã“ã</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn-block" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </form>
            <div style="text-align: center; margin-top: 16px; color: var(--text-secondary);">
                ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„ã§ã™ã‹ï¼Ÿ 
                <a style="color: var(--primary); cursor: pointer;" onclick="switchModal('login', 'signup')">ä»Šã™ãç™»éŒ²</a>
            </div>
        </div>
    </div>

    <!-- ä¼šå“¡ç™»éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="signupModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('signup')">Ã—</button>
            <div class="modal-header">
                <h2>ä¼šå“¡ç™»éŒ²</h2>
                <p>ç„¡æ–™ã§TaskFlowã‚’å§‹ã‚ã¾ã—ã‚‡ã†</p>
            </div>
            <form onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label>åå‰</label>
                    <input type="text" id="signupName" required>
                </div>
                <div class="form-group">
                    <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="signupPassword" minlength="8" required>
                </div>
                <button type="submit" class="btn-block" id="signupBtn">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</button>
            </form>
            <div style="text-align: center; margin-top: 16px; color: var(--text-secondary);">
                æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã™ã‹ï¼Ÿ 
                <a style="color: var(--primary); cursor: pointer;" onclick="switchModal('signup', 'login')">ãƒ­ã‚°ã‚¤ãƒ³</a>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¹ã‚¯ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="createTaskModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('createTask')">Ã—</button>
            <div class="modal-header">
                <h2>ã‚¿ã‚¹ã‚¯ä½œæˆ</h2>
            </div>
            <form onsubmit="handleCreateTask(event)">
                <div class="form-group">
                    <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label>èª¬æ˜</label>
                    <textarea id="taskDescription" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label>å„ªå…ˆåº¦</label>
                    <select id="taskPriority">
                        <option value="HIGH">é«˜</option>
                        <option value="MEDIUM" selected>ä¸­</option>
                        <option value="LOW">ä½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æœŸé™</label>
                    <input type="date" id="taskDueDate">
                </div>
                <div class="form-group">
                    <label>ãƒãƒ¼ãƒ </label>
                    <select id="taskTeam" required>
                        <option value="">ãƒãƒ¼ãƒ ã‚’é¸æŠ</option>
                    </select>
                </div>
                <button type="submit" class="btn-block" id="createTaskBtn">ä½œæˆ</button>
            </form>
        </div>
    </div>

    <!-- ãƒãƒ¼ãƒ ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="createTeamModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('createTeam')">Ã—</button>
            <div class="modal-header">
                <h2>ãƒãƒ¼ãƒ ä½œæˆ</h2>
            </div>
            <form onsubmit="handleCreateTeam(event)">
                <div class="form-group">
                    <label>ãƒãƒ¼ãƒ å</label>
                    <input type="text" id="teamName" required>
                </div>
                <div class="form-group">
                    <label>èª¬æ˜</label>
                    <textarea id="teamDescription" rows="4"></textarea>
                </div>
                <button type="submit" class="btn-block" id="createTeamBtn">ä½œæˆ</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        const TOKEN_KEY = 'taskflow_token';
        const USER_KEY = 'taskflow_user';

        let currentUser = null;
        let tasks = [];
        let teams = [];

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        // èªè¨¼ç¢ºèª
        function checkAuth() {
            const token = localStorage.getItem(TOKEN_KEY);
            const user = JSON.parse(localStorage.getItem(USER_KEY) || 'null');
            
            if (token && user) {
                currentUser = user;
                showDashboard();
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ
        function openModal(type) {
            document.getElementById(`${type}Modal`).classList.add('active');
        }

        function closeModal(type) {
            document.getElementById(`${type}Modal`).classList.remove('active');
        }

        function switchModal(from, to) {
            closeModal(from);
            setTimeout(() => openModal(to), 100);
        }

        // ä¼šå“¡ç™»éŒ²
        async function handleSignup(e) {
            e.preventDefault();
            const btn = document.getElementById('signupBtn');
            btn.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;

            const data = {
                name: document.getElementById('signupName').value,
                email: document.getElementById('signupEmail').value,
                password: document.getElementById('signupPassword').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('ä¼šå“¡ç™»éŒ²æˆåŠŸï¼ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚', 'success');
                    setTimeout(() => {
                        switchModal('signup', 'login');
                        document.getElementById('loginEmail').value = data.email;
                    }, 1500);
                } else {
                    showAlert(result.message || 'ä¼šå“¡ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showAlert('æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
            } finally {
                btn.innerHTML = 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ';
                btn.disabled = false;
            }
        }

        // ãƒ­ã‚°ã‚¤ãƒ³
        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            btn.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;

            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPassword').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success && result.data) {
                    localStorage.setItem(TOKEN_KEY, result.data.accessToken);
                    
                    const userInfo = await getUserInfo(result.data.accessToken);
                    if (userInfo) {
                        localStorage.setItem(USER_KEY, JSON.stringify(userInfo));
                        currentUser = userInfo;
                        closeModal('login');
                        showDashboard();
                    }
                } else {
                    showAlert(result.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showAlert('æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚', 'error');
            } finally {
                btn.innerHTML = 'ãƒ­ã‚°ã‚¤ãƒ³';
                btn.disabled = false;
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
        async function getUserInfo(token) {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();
                return result.success ? result.data : null;
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                return null;
            }
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
        function showDashboard() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('dashboardPage').classList.add('active');
            document.getElementById('mainNav').style.display = 'none';
            document.getElementById('dashboardNav').style.display = 'flex';
            
            document.getElementById('navEmail').textContent = currentUser.email;
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();

            loadTasks();
            loadTeams();
        }

        // ã‚¿ã‚¹ã‚¯èª­ã¿è¾¼ã¿
        async function loadTasks() {
            const token = localStorage.getItem(TOKEN_KEY);
            try {
                const response = await fetch(`${API_BASE}/tasks`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                if (result.success && result.data) {
                    tasks = Array.isArray(result.data) ? result.data : 
                           (result.data.content || []);
                    displayTasks();
                }
            } catch (error) {
                console.error('ã‚¿ã‚¹ã‚¯èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                tasks = [];
                displayTasks();
            }
        }

        // ã‚¿ã‚¹ã‚¯è¡¨ç¤º
        function displayTasks() {
            const taskList = document.getElementById('taskList');
            
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('todoTasks').textContent = 
                tasks.filter(t => t.status === 'TODO').length;
            document.getElementById('progressTasks').textContent = 
                tasks.filter(t => t.status === 'IN_PROGRESS').length;
            document.getElementById('doneTasks').textContent = 
                tasks.filter(t => t.status === 'DONE').length;

            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <h3>ã‚¿ã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                        <p>æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¦å§‹ã‚ã¾ã—ã‚‡ã†</p>
                    </div>
                `;
                return;
            }

            taskList.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <div class="task-info">
                        <h4>${task.title}</h4>
                        <div class="task-meta">
                            <span>ğŸ“… ${task.dueDate || 'æœŸé™ãªã—'}</span>
                            <span>ğŸ‘¤ ${task.assignee?.name || 'æœªå‰²ã‚Šå½“ã¦'}</span>
                            <span class="badge ${getPriorityClass(task.priority)}">${getPriorityText(task.priority)}</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <span class="badge ${getStatusClass(task.status)}">${getStatusText(task.status)}</span>
                    </div>
                </div>
            `).join('');
        }

        // ãƒãƒ¼ãƒ èª­ã¿è¾¼ã¿
        async function loadTeams() {
            const token = localStorage.getItem(TOKEN_KEY);
            try {
                const response = await fetch(`${API_BASE}/teams`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                if (result.success && result.data) {
                    teams = Array.isArray(result.data) ? result.data : [];
                    displayTeams();
                    updateTeamSelect();
                }
            } catch (error) {
                console.error('ãƒãƒ¼ãƒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                teams = [];
                displayTeams();
            }
        }

        // ãƒãƒ¼ãƒ è¡¨ç¤º
        function displayTeams() {
            const teamList = document.getElementById('teamList');
            
            if (teams.length === 0) {
                teamList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ‘¥</div>
                        <h3>ãƒãƒ¼ãƒ ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                        <p>æ–°ã—ã„ãƒãƒ¼ãƒ ã‚’ä½œæˆã—ã¦å”æ¥­ã‚’å§‹ã‚ã¾ã—ã‚‡ã†</p>
                    </div>
                `;
                return;
            }

            teamList.innerHTML = `
                <div class="grid-2">
                    ${teams.map(team => `
                        <div class="team-card">
                            <div class="team-icon">ğŸ‘¥</div>
                            <div class="team-header">
                                <div>
                                    <h4 style="font-size: 20px; margin-bottom: 8px;">${team.name}</h4>
                                    <p style="color: var(--text-secondary);">${team.description || 'èª¬æ˜ãªã—'}</p>
                                </div>
                            </div>
                            <div style="margin-top: 16px; font-size: 14px; color: var(--text-secondary);">
                                ä½œæˆè€…: ${team.createdBy?.name || 'ä¸æ˜'}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ãƒãƒ¼ãƒ é¸æŠæ›´æ–°
        function updateTeamSelect() {
            const select = document.getElementById('taskTeam');
            select.innerHTML = '<option value="">ãƒãƒ¼ãƒ ã‚’é¸æŠ</option>' +
                teams.map(team => `<option value="${team.id}">${team.name}</option>`).join('');
        }

        // ã‚¿ã‚¹ã‚¯ä½œæˆ
        async function handleCreateTask(e) {
            e.preventDefault();
            const btn = document.getElementById('createTaskBtn');
            btn.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;

            const data = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value || null,
                teamId: parseInt(document.getElementById('taskTeam').value)
            };

            const token = localStorage.getItem(TOKEN_KEY);

            try {
                const response = await fetch(`${API_BASE}/tasks`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('ã‚¿ã‚¹ã‚¯ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼', 'success');
                    closeModal('createTask');
                    e.target.reset();
                    loadTasks();
                } else {
                    showAlert(result.message || 'ã‚¿ã‚¹ã‚¯ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showAlert('æ¥ç¶šã‚¨ãƒ©ãƒ¼', 'error');
            } finally {
                btn.innerHTML = 'ä½œæˆ';
                btn.disabled = false;
            }
        }

        // ãƒãƒ¼ãƒ ä½œæˆ
        async function handleCreateTeam(e) {
            e.preventDefault();
            const btn = document.getElementById('createTeamBtn');
            btn.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;

            const data = {
                name: document.getElementById('teamName').value,
                description: document.getElementById('teamDescription').value
            };

            const token = localStorage.getItem(TOKEN_KEY);

            try {
                const response = await fetch(`${API_BASE}/teams`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('ãƒãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼', 'success');
                    closeModal('createTeam');
                    e.target.reset();
                    loadTeams();
                } else {
                    showAlert(result.message || 'ãƒãƒ¼ãƒ ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                showAlert('æ¥ç¶šã‚¨ãƒ©ãƒ¼', 'error');
            } finally {
                btn.innerHTML = 'ä½œæˆ';
                btn.disabled = false;
            }
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tab}Tab`).classList.add('active');

            if (tab === 'tasks') loadTasks();
            if (tab === 'teams') loadTeams();
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            localStorage.removeItem(TOKEN_KEY);
            localStorage.removeItem(USER_KEY);
            location.reload();
        }

        // ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
        function goHome() {
            if (currentUser) {
                location.reload();
            }
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type} active`;
            setTimeout(() => alert.classList.remove('active'), 3000);
        }

        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function getStatusClass(status) {
            const map = {
                'TODO': 'todo',
                'IN_PROGRESS': 'progress',
                'DONE': 'done'
            };
            return map[status] || 'todo';
        }

        function getStatusText(status) {
            const map = {
                'TODO': 'æœªç€æ‰‹',
                'IN_PROGRESS': 'é€²è¡Œä¸­',
                'DONE': 'å®Œäº†'
            };
            return map[status] || 'æœªç€æ‰‹';
        }

        function getPriorityClass(priority) {
            return (priority || 'medium').toLowerCase();
        }

        function getPriorityText(priority) {
            const map = {
                'HIGH': 'é«˜',
                'MEDIUM': 'ä¸­',
                'LOW': 'ä½'
            };
            return map[priority] || 'ä¸­';
        }

        function scrollTo(id) {
            document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
